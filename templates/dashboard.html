{% extends "layout.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}

    <div class="dashboard-container fade-in">

        <div class="dashboard-header glass-card slide-down">
            <h2 class="page-title">Your Financial Dashboard</h2>
            <p class="subtitle">A real-time overview of your wallet, spending, and activity</p>
        </div>

        <div class="summary-grid">

            <div class="summary-card glass-card pop-in">
                <p class="label">Wallet Balance</p>
                <h1 class="value" id="liveBalance">₹{{ balance }}</h1>
                <span class="tag">Real-time</span>
            </div>

            <div class="summary-card glass-card pop-in">
                <p class="label">Total Spent (This Month)</p>
                <h1 class="value red">₹{{ monthly_spent or 0 }}</h1>
                <span class="tag red-tag">Expenses</span>
            </div>

            <div class="summary-card glass-card pop-in">
                <p class="label">Total Income (This Month)</p>
                <h1 class="value green">₹{{ monthly_income or 0 }}</h1>
                <span class="tag green-tag">Income</span>
            </div>

        </div>

        <div class="graphs-grid">

            <div class="graph-card glass-card lift-in">
                <h3 class="graph-title">Monthly Spending Overview</h3>
                <canvas id="monthlyChart"></canvas>
            </div>

            <div class="graph-card glass-card lift-in">
                <h3 class="graph-title">Category Split</h3>
                <canvas id="pieChart"></canvas>
            </div>

        </div>

        <div class="recent-card glass-card fade-up">
            <h3 class="section-title">Recent Transactions</h3>

            <div class="transactions-list">
                {% for txn in recent %}
                    <div class="txn-item fade-in-up">
                        <div class="txn-info">
                            <p class="merchant">{{ txn.merchant }}</p>
                            <p class="category">{{ txn.category or 'Uncategorized' }}</p>
                        </div>

                        <div class="txn-meta">
                            <p class="amount {% if txn.type=='expense' %}red{% else %}green{% endif %}">
                                {% if txn.type=='expense' %}-{% else %}+{% endif %}
                                ₹{{ txn.amount }}
                            </p>
                            <p class="date">{{ txn.date }}</p>
                        </div>
                    </div>
                {% endfor %}
            </div>

        </div>

    </div>


    <script>
    // Animate Cards on Load
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".glass-card").forEach((el, i) => {
                setTimeout(() => {
                    el.classList.add("visible");
                }, i * 150);
            });
        });

    // Monthly Chart Data
        const monthlyData = {
            {
                monthly_chart | tojson
            }
        };
        const months = monthlyData.map(x => x.month);
        const expenses = monthlyData.map(x => x.expenses);
        const income = monthlyData.map(x => x.income);

        new Chart(document.getElementById("monthlyChart"), {
            type: "line",
            data: {
                labels: months,
                datasets: [{
                    label: "Expenses",
                    data: expenses,
                    borderWidth: 2
                },
                    {
                        label: "Income",
                        data: income,
                        borderWidth: 2
                    }
                ]
            },
            options: {
                tension: 0.4,
                animation: {
                    duration: 1500
                }
            }
        });

    // Pie Chart
        const pieData = {
            {
                pie_data | tojson
            }
        };
        new Chart(document.getElementById("pieChart"), {
            type: "pie",
            data: {
                labels: pieData.map(x => x.category),
                datasets: [{
                    data: pieData.map(x => x.total),
                    borderWidth: 2
                }]
            },
            options: {
                animation: {
                    duration: 1200
                }
            }
        });
    </script>


    <style>
        .dashboard-container {
            padding: 25px;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
        }

        .subtitle {
            opacity: .7;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            padding: 25px;
            border-radius: 18px;
        }

        .label {
            font-size: .95rem;
            opacity: .7;
        }

        .value {
            font-size: 2.2rem;
            font-weight: 700;
        }

        .value.red {
            color: #ff5252;
        }

        .value.green {
            color: #00e676;
        }

        .tag {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            font-size: .8rem;
        }

        .red-tag {
            color: #ff5252;
            background: #ff525222;
        }

        .green-tag {
            color: #00e676;
            background: #00e67622;
        }

        .graphs-grid {
            margin-top: 30px;
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        }

        .graph-card {
            padding: 20px;
            border-radius: 18px;
        }

        .recent-card {
            margin-top: 30px;
            padding: 20px;
            border-radius: 18px;
        }

        .transactions-list {
            margin-top: 15px;
        }

        .txn-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .txn-info .merchant {
            font-weight: 600;
        }

        .txn-info .category {
            font-size: .9rem;
            opacity: .6;
        }

        .txn-meta .amount {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .txn-meta .amount.red {
            color: #ff5252;
        }

        .txn-meta .amount.green {
            color: #00e676;
        }

        .txn-meta .date {
            opacity: .6;
            font-size: .85rem;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(14px);
            transform: translateY(25px) scale(0.95);
            opacity: 0;
            transition: .6s ease;
        }

        .glass-card.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .fade-up {
            animation: fadeUp .8s ease;
        }

        .fade-in {
            animation: fadeIn .8s ease;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>

{% endblock %}
